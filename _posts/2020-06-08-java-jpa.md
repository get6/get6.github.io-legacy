---
layout: post
title: JPA 정리
tags: jpa java hibernate
comments: true
---

자바 ORM 표준 JPA 프로그래밍을 읽으면서 정리할 예정입니다.

### 엔티티 매니저 팩토리

앤티티 매니저를 만드는 공장이다. EntityManagerFactory는 객체 생성 비용이 크기 때문에 애플리케이션 전체에서 공유하도록 설계되어 있다.  
여러 스레드가 동시에 접근해도 안전하므로 서로 다른 스레드 간에 공유해도 된다.
이때, 커넥션풀도 만든다.

### 엔티티 매니저

엔티티를 저장, 수정, 삭제, 조회 등을 처리한다. 엔티티를 저장하는 가상의 데이터베이스로 생각해도 된다.  
여러 스레드가 동시에 접근하면 동시성 문제가 발생하므로 스레드 간에 절대 공유하면 안 된다.  
연결이 필요한 시점에 커넥션을 얻는다. ex) 트랙젝션을 시작할 때 획득

### 영속성 컨텍스트

해석하면 <b style="color:cyan;">엔티티를 영구 저장하는 환경</b>이라는 뜻  
em.persiste(account); 메소드는 엔티티 매니저를 사용해서 계정 엔티티를 영속성 컨텍스트에 저장한다.
여러 엔티티 매니저가 같은 영속성 컨텍스트에 접근할 수 있다.

- 엔티티의 생명주기
  1. 비영속(new/transient): 영속성 컨텍스트와 전혀 관계가 없는 상태
  2. 영속(managed): 영속성 컨텍스트에 저장된 상태
  3. 준영속(detached): 영속성 컨텍스트에 저장되었다가 분리된 상태
  4. 삭제(removed): 삭제된 상태

### 플러시

flush()는 영속성 컨텍스트의 변경 내용을 데이터베이스에 반영한다.

1. 직접 호출
2. 트랜잭션 커밋 시 플러시 자동 호출
3. JPQL 쿼리 실행 시 플러시 자동 호출
