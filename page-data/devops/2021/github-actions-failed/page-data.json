{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/devops/2021/github-actions-failed/","result":{"data":{"site":{"siteMetadata":{"title":"Jun Wick's Blog","author":{"name":"Sung Jun, Hwang"}}},"markdownRemark":{"id":"aec666fc-a0c3-5b76-80ac-ea8450772a9e","excerpt":"블로그 source 브랜치를 깃허브에 push하면 자동적으로 master 브랜치에 deploy하려고 했는데 이게 매번 실패했다. 나는 가끔 글을 쓰고 수동으로 배포 작업을했는데 어느날, 메일에 CI 작업이 실패했다고 와서 알게됬다. 한동안은 블로그를 typescript…","html":"<p>블로그 source 브랜치를 깃허브에 push하면 자동적으로 master 브랜치에 deploy하려고 했는데 이게 매번 실패했다.</p>\n<p>나는 가끔 글을 쓰고 수동으로 배포 작업을했는데 어느날, 메일에 CI 작업이 실패했다고 와서 알게됬다.</p>\n<p>한동안은 블로그를 typescript로 바꾸느라 애먹고 있었는데 이번에 error를 다 없앤김에 이 오류도 해결하기로 마음 먹었다.</p>\n<p>가장 최근에 오류는 이것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d1e8f4b53806792ace42bb39277f9136/7be33/build-failed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/0lEQVQ4y42U2XKbQBBFeUiiBcQ27LtAICHJyLZkV9mVyv//1U33GDB2ZEcPt6anhzlzZ2mUP0WF7d0ZLau7YLM7YXc8o2yO2J+eKH9Bd37F9vgo+/dPv9E9vlDuhfrPaA4PKOoD4rxBVu2hhGGOpNgiSCo4FDtBDpdaEWRwo0L2hZ/CdCJYbgzbS0aJvuWxleXLcSVe71DvHxAT1PJSAjEgk0COTSeGbge0ekvfNAjTjZQbrbFyUqiGJxdMiaOZHhTb56QLjcSrcHLQ0LfcBOW2k9Awrd6UNXCyA3QR0S4yOqI7GORU6fIKUV5LKAOmGqA8NlsamKsWFpo9armyoeoOtYLGTBkrBk3gLQ2Tr0ENGm/aE8p6j6o5wAtS/JqvMFvosp3GyuftjbBJnh2wmxEw0/BTSpUt5wcpn7d3DajpAp4TwqHztvi2e9l0q4btjw4/AP/RxLVBurSdfHdp2SIjpeUOxeaAKKul45uAg0O+gB80STrpz+wrfQ203oEqbfltgo750sSCb1s1e1kf9A3w/Wy5EmJ6Wsl6KyuDX4UhQil9KsrfBOQHm9VH1O09lWgp3+U1yUr5HuhBNX24tHpBNyyoxj2qb651t4+dPua6Z+h/gRoBhQiQJwSgH4gfr6XYKQOHmMuRa/omoCHIZZQQYD268ggk/0i9U69f6C8zjY8jM+zUpwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"actions-failed\"\n        title=\"actions-failed\"\n        src=\"/static/d1e8f4b53806792ace42bb39277f9136/fcda8/build-failed.png\"\n        srcset=\"/static/d1e8f4b53806792ace42bb39277f9136/12f09/build-failed.png 148w,\n/static/d1e8f4b53806792ace42bb39277f9136/e4a3f/build-failed.png 295w,\n/static/d1e8f4b53806792ace42bb39277f9136/fcda8/build-failed.png 590w,\n/static/d1e8f4b53806792ace42bb39277f9136/efc66/build-failed.png 885w,\n/static/d1e8f4b53806792ace42bb39277f9136/c83ae/build-failed.png 1180w,\n/static/d1e8f4b53806792ace42bb39277f9136/7be33/build-failed.png 1558w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>문제는 <code class=\"language-text\">The process &#39;npm&#39; failed with exit code 254</code> 이거 같은데 나는 GitHub Actions을 이해하고 쓰지 않았고 예제를 보며해봤기 때문에 이참에</p>\n<p>GitHub Actions 가이드 문서를 보기로 했다. -> <a href=\"https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions\">Introduction to GitHub Actions</a> 과 <a href=\"https://docs.github.com/en/actions/guides/building-and-testing-nodejs\">Building and Testing NodeJS</a></p>\n<p>나는 이 사람이 만든 <a href=\"https://github.com/enriikke/gatsby-gh-pages-action\">Action</a>을 이용했고, 기존 코드를 수정할 필요가 있었다.</p>\n<p>기존 코드는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node</span>\n<span class=\"token comment\"># For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions</span>\n\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GatsbyJS Deploy\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> source <span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Publish\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> enriikke/gatsby<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages<span class=\"token punctuation\">-</span>action@v2.1.1\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># A personal access token needed to push your site after it has been built.</span>\n        <span class=\"token key atrule\">access-token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GATSBY_PUBLISH_ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token comment\"># The branch expected by GitHub to have the static files needed for your site.</span>\n        <span class=\"token key atrule\">deploy-branch</span><span class=\"token punctuation\">:</span> master <span class=\"token comment\"># optional, default is master</span>\n        <span class=\"token comment\"># Additional arguments that get passed to `gatsby build`.</span>\n        <span class=\"token key atrule\">gatsby-args</span><span class=\"token punctuation\">:</span> gh<span class=\"token punctuation\">-</span>pages <span class=\"token punctuation\">-</span>d public <span class=\"token comment\"># optional, default i</span></code></pre></div>\n<p>수정을 몇번 해보면서 테스트 해보니 <code class=\"language-text\">every step must define a `uses` or `run` key</code>라는 오류가 떴었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Publish\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> enriikke/gatsby<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages<span class=\"token punctuation\">-</span>action@v2.1.1</code></pre></div>\n<p>원인은 name 다음에는 해당 하나의 uses만 있어야 하는데 배열 선언 방식으로 해서 그런거 같다.<br>\n해결 방법은 아래처럼 하면된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Publish\n  <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> enriikke/gatsby<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages<span class=\"token punctuation\">-</span>action@v2.1.1</code></pre></div>\n<p>또 이런 에러도 났었다. <code class=\"language-text\">The process &#39;git&#39; failed with exit code 128</code>\n이건 내가 GATSBY<em>PUBLISH</em>ACCESS<em>TOKEN을 잘 못 넣었다.<br>\nGitHub.com -> Settings -> Developer settings -> Personal access tokens -> Generate new token을 누르고 원하는 이름으로 발급된 토큰값을 복사한다.<br>\n그 다음 블로그 Repository로 간 다음, Setting -> Secrets에 원하는 이름을 넣고(내 경우는 GATSBY</em>PUBLISH<em>ACCESS</em>TOKEN) 거기에 아까 만든 토큰값을 붙여 넣는다.</p>\n<p>배포에 사용되는 코드는 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GatsbyJS Deploy\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> source\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Gatsby Publish\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> enriikke/gatsby<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages<span class=\"token punctuation\">-</span>action@v2.1.1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token comment\"># A personal access token needed to push your site after it has been built.</span>\n          <span class=\"token key atrule\">access-token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GATSBY_PUBLISH_ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">gatsby-args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>verbose\n          </code></pre></div>","tableOfContents":"","frontmatter":{"title":"GitHub Actions가 에러날 때 해결방법","date":"March 15, 2021","description":null,"image":null}},"allMarkdownRemark":{"edges":[{"node":{"fields":{"slug":"/devops/2020/system-admin-girl1/"},"frontmatter":{"title":"만화로 배우는 리눅스 시스템 관리 1권","date":"2021-03-14"}}},{"node":{"fields":{"slug":"/devops/2020/linux-command/"},"frontmatter":{"title":"만화로 배우는 리눅스 시스템 관리 1권 정리 첫번째","date":"2020-04-25"}}},{"node":{"fields":{"slug":"/devops/2020/aws-ec2-ssh/"},"frontmatter":{"title":"mac에서 EC2 ssh 접속","date":"2020-04-09"}}},{"node":{"fields":{"slug":"/devops/2020/aws-ec2-nvm/"},"frontmatter":{"title":"EC2에서 NVM Permission Denied 해결","date":"2020-04-09"}}},{"node":{"fields":{"slug":"/devops/2020/information-network-words/"},"frontmatter":{"title":"정보통신망 용어 정리","date":"2020-03-21"}}},{"node":{"fields":{"slug":"/devops/2020/computing-word/"},"frontmatter":{"title":"컴퓨터 용어 정리","date":"2020-03-19"}}},{"node":{"fields":{"slug":"/devops/2020/docker-quick-start-build/"},"frontmatter":{"title":"Docker Quick Start Step3 Build on Windows","date":"2020-02-07"}}},{"node":{"fields":{"slug":"/devops/2020/githooks/"},"frontmatter":{"title":"Git pre-commit lint-staged 에러 날때","date":"2020-02-05"}}}]}},"pageContext":{"slug":"/devops/2021/github-actions-failed/","tag":"devops","previous":{"fields":{"slug":"/devops/2020/system-admin-girl1/"},"frontmatter":{"tags":["devops","linux"]}},"next":null}},"staticQueryHashes":["1146911855","1973561601","3826269039"]}