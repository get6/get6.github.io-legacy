{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/backend/2020/mapstruct-guide-second/","result":{"data":{"site":{"siteMetadata":{"title":"Jun Wick's Blog","author":{"name":"Sung Jun, Hwang"}}},"markdownRemark":{"id":"830cf225-fa26-52db-a194-e9cd6ebd79d9","excerpt":"MapStruc 에러 해결 첫번째를 보고 오시는 걸 추천드립니다. 이런 상황도 있었습니다. 표현 계층에서 Transaction이 끝난 객체를 변환하는 작업(toDTO)을 하는 도중에 에러가 났었습니다. 조회하지 않은 Entity 속 변수 중 하나가 JPA…","html":"<p><a href=\"https://get6.github.io/2020/08/07/mapstruct-guide-first.html\">MapStruc 에러 해결 첫번째</a>를 보고 오시는 걸 추천드립니다.</p>\n<p>이런 상황도 있었습니다.</p>\n<p>표현 계층에서 Transaction이 끝난 객체를 변환하는 작업(toDTO)을 하는 도중에 에러가 났었습니다.<br>\n조회하지 않은 Entity 속 변수 중 하나가 JPA 에러가난 상황이었습니다.</p>\n<p>이 경우를 방지하기 위해선</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserMapper</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>부분생략\n  <span class=\"token annotation punctuation\">@BeforeMapping</span>\n  <span class=\"token keyword\">default</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">LinkedHashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">fixLazyLoadingSet</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> c<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@TargetType</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> targetType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">PengHaUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">wasInitialized</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedHashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@BeforeMapping</span>\n  <span class=\"token keyword\">default</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">fixLazyLoadingList</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> c<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@TargetType</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> targetType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">PengHaUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">wasInitialized</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> <span class=\"token class-name\">Collections</span><span class=\"token punctuation\">.</span><span class=\"token function\">emptyList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 함수에선 Util class에 있는 함수를 호출합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  <span class=\"token comment\">/**\n   * check JPA initialized for MapStruct\n   *\n   * @param c Target\n   * @return Was this collection initialized?  Or is its data still not (fully) loaded?\n   */</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">wasInitialized</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> c<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>c <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">PersistentCollection</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token class-name\">PersistentCollection</span> pc <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">PersistentCollection</span><span class=\"token punctuation\">)</span> c<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> pc<span class=\"token punctuation\">.</span><span class=\"token function\">wasInitialized</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>이런식으로 UserMapper에서 User 객체 속 Collection 객체들을 변환하기 전에 초기화를 해주는 작업이 들어가야 에러가 나지 않습니다.</p>\n<hr>\n<p>또 다른 상황은</p>\n<p>UserRoleMapper에 <code class=\"language-text\">List&lt;UserRoleDTO&gt; toDTO(Collection&lt;UserRoleDTO&gt; userRoleDTOs)</code>를 선언한 일이 있었습니다.<br>\n이렇게 User Entity를 기준으로 하위 {Entity}Mapper.class 마다 Collection 변환을 만들어 주면 상위 객체에서도 참조하는 상황이 생깁니다.</p>\n<p>이런 경우 User Entity에 있는 userRoles가 이 메소드를 활용하여 변환 되므로 JPA LazyException이 발생합니다.<br>\n위에 있는 BeforeMapping이 무시되고 해당 구현 함수를 참조하여 위 에러가 해결되지 않았습니다.<br>\n따라서 Collection DTO &#x3C;-> Entity 구현 함수는 상위 EntityMapper에 구현 하시길 바랍니다.</p>","tableOfContents":"","frontmatter":{"title":"MapStruct 에러 해결 두번째","date":"August 07, 2020","description":null,"image":null}},"allMarkdownRemark":{"edges":[{"node":{"fields":{"slug":"/methodology/2021/gof-design-patterns/"},"frontmatter":{"title":"GoF(Gang of Four) Design Patterns 정리","date":"2021-01-17"}}},{"node":{"fields":{"slug":"/backend/2021/nextauth-guide/"},"frontmatter":{"title":"Next.js로 Admin 만들기","date":"2021-01-16"}}},{"node":{"fields":{"slug":"/backend/2020/test-driven-development/"},"frontmatter":{"title":"TDD(TEST DRIVEN DEVELOPMENT)를 SPRING BOOT에 사용하기","date":"2020-12-01"}}},{"node":{"fields":{"slug":"/backend/2020/mapstruct-guide-first/"},"frontmatter":{"title":"MapStruct 에러 해결 첫번째","date":"2020-08-07"}}},{"node":{"fields":{"slug":"/backend/2020/spring-security-example1/"},"frontmatter":{"title":"스프링 시큐리티 구축 1","date":"2020-06-17"}}},{"node":{"fields":{"slug":"/backend/2020/spring-security/"},"frontmatter":{"title":"스프링 시큐리티 구축","date":"2020-06-13"}}},{"node":{"fields":{"slug":"/backend/2020/java-jpa/"},"frontmatter":{"title":"JPA 정리","date":"2020-06-08"}}},{"node":{"fields":{"slug":"/backend/2020/spring-msa-config/"},"frontmatter":{"title":"스프링 부트 MSA 프로젝트 - config 서버 구축","date":"2020-05-27"}}},{"node":{"fields":{"slug":"/backend/2020/spring-initializr-gradle-type/"},"frontmatter":{"title":"Spring Initializr Gradle Type 비교","date":"2020-03-24"}}},{"node":{"fields":{"slug":"/backend/2020/type-of-traffic/"},"frontmatter":{"title":"인바운드 트래픽과 아웃바운드 트래픽 설명","date":"2020-03-18"}}},{"node":{"fields":{"slug":"/backend/2020/gradle-summary/"},"frontmatter":{"title":"Gradle 정리","date":"2020-03-16"}}},{"node":{"fields":{"slug":"/backend/2020/nodejs-express-guid/"},"frontmatter":{"title":"Express 가이드","date":"2020-03-13"}}},{"node":{"fields":{"slug":"/backend/2020/backend-roadmap1/"},"frontmatter":{"title":"Backend Developer - How does the internet work?","date":"2020-03-10"}}},{"node":{"fields":{"slug":"/backend/2020/openbanking-test/"},"frontmatter":{"title":"OpenBanking test 적용","date":"2020-03-10"}}},{"node":{"fields":{"slug":"/backend/2020/python-dynamic-parameter/"},"frontmatter":{"title":"Python binds dynamic parameters","date":"2020-02-21"}}},{"node":{"fields":{"slug":"/backend/2020/mybatis-parameter/"},"frontmatter":{"title":"Mybatis parameter 조심해야할 점","date":"2020-02-13"}}},{"node":{"fields":{"slug":"/backend/2020/sql-problem-solving/"},"frontmatter":{"title":"SQL 가상으로 목록 만들기","date":"2020-02-10"}}},{"node":{"fields":{"slug":"/backend/2020/python-exec-example/"},"frontmatter":{"title":"파이썬 exec 함수 사용방법","date":"2020-01-30"}}},{"node":{"fields":{"slug":"/backend/2020/mariadb-rule/"},"frontmatter":{"title":"MariaDB 문자열 합치기","date":"2020-01-21"}}},{"node":{"fields":{"slug":"/backend/2020/vscode-java-clean/"},"frontmatter":{"title":"vscode에서 java clean하는 법","date":"2020-01-20"}}}]}},"pageContext":{"slug":"/backend/2020/mapstruct-guide-second/","tag":"backend","previous":{"fields":{"slug":"/others/2020/social-network-account-info/"},"frontmatter":{"tags":["others","login"]}},"next":{"fields":{"slug":"/backend/2020/mapstruct-guide-first/"},"frontmatter":{"tags":["backend","mapstruct","spring"]}}}},"staticQueryHashes":["1146911855","1973561601","3826269039"]}