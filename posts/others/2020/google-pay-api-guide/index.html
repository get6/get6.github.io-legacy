<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/cf50bc513bb312fb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cf50bc513bb312fb.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cf392dd387379326.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cf392dd387379326.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer=""></script><script src="/_next/static/chunks/framework-7751730b10fa0f74.js" defer=""></script><script src="/_next/static/chunks/main-417c86299e0e3115.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3f357b7937ff6115.js" defer=""></script><script src="/_next/static/chunks/358-1fc680902af364db.js" defer=""></script><script src="/_next/static/chunks/675-717e3cc8fb67a947.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5B...slug%5D-f8930ebaf4ef3376.js" defer=""></script><script src="/_next/static/x4I7aGmlNNdMMn8qGuRvp/_buildManifest.js" defer=""></script><script src="/_next/static/x4I7aGmlNNdMMn8qGuRvp/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav class="absolute w-full pt-3"><div class="container mx-auto flex flex-wrap"><a class="w-2/6 text-lg font-bold" href="/">🌎 Sunhwang&#x27;s blog</a><ul class="flex grow justify-end space-x-10"><li><a class="hover:underline hover:underline-offset-8 " href="/tags">Tags</a></li><li><a class="hover:underline hover:underline-offset-8 " href="/about">About me</a></li></ul></div></nav><main><div class="container mx-auto pt-10"><article class="mb-32"><div class="mx-auto flex max-w-6xl justify-start align-middle"><h1 class="mt-20 mb-6 text-5xl font-bold leading-tight tracking-tighter md:text-left md:text-7xl md:leading-none lg:text-4xl">Google Pay API 가이드</h1></div><div class="mb-8 sm:mx-0 md:mb-16"><div class="sm:mx-0"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0"><img alt="Cover Image for Google Pay API 가이드" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="shadow-sm" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Cover Image for Google Pay API 가이드" src="" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="shadow-sm" loading="lazy"/></noscript></span></div></div><div class="mx-auto flex max-w-5xl justify-end"><div class="mb-4 text-sm text-gray-600 underline underline-offset-8"><time dateTime="2020-03-13">2020-03-13</time></div></div><div class="mx-auto max-w-6xl"><article class="markdown-styles_markdown__h_8de"><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Contents</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<p>Google Pay API를 해보는 과정을 정리해보려고 합니다.</p>
<p>Google Pay API를 테스트하기전에 nodeJS express를 통해 웹서버를 만들어야 합니다. <a href="/2020-03-13-nodejs-express-guide.markdown">링크</a></p>
<p><a href="https://developers.google.com/pay/api/web/guides/setup">Google Pay API 설정</a>에서 결제 수단을 링크를 눌러 카드를 등록합니다.</p>
<p>로그인 한 계정에 신용카드 또는 체크카드를 추가하면 결제 수단 등록이 완료됩니다.</p>
<p>이제 왼쪽 네비게이션 가이드 - 가이드 메뉴를 누릅니다.</p>
<p><img src="./images/google-pay-selected-guide.png" alt="구글 가이드">{: width="50%"}</p>
<p>가이드를 참조하시면서 함수와 설명을 잘 읽어봅니다.
버튼이 나타나기 위해선 아래와 같이 div로 버튼 영역을 잡아주고
아래 스크립트는 구글페이를 사용하기 위해서 필요한 외부함수입니다. 저희쪽에서 가지고 있을 js파일이 아닙니다.</p>
<pre><code class="language-html">&#x3C;div id="container">&#x3C;/div>
&#x3C;script
  async
  src="https://pay.google.com/gp/p/js/pay.js"
  onload="onGooglePayLoaded()"
>&#x3C;/script>
</code></pre>
<p>아래는 우리쪽에서 파일로 만들어야 할 js입니다.</p>
<pre><code class="language-javascript">/**
 * Define the version of the Google Pay API referenced when creating your
 * configuration
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#PaymentDataRequest|apiVersion in PaymentDataRequest}
 */
const baseRequest = {
  apiVersion: 2,
  apiVersionMinor: 0,
}

/**
 * Card networks supported by your site and your gateway
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}
 * @todo confirm card networks supported by your site and gateway
 */
const allowedCardNetworks = [
  "AMEX",
  "DISCOVER",
  "INTERAC",
  "JCB",
  "MASTERCARD",
  "VISA",
]

/**
 * Card authentication methods supported by your site and your gateway
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}
 * @todo confirm your processor supports Android device tokens for your
 * supported card networks
 */
const allowedCardAuthMethods = ["PAN_ONLY", "CRYPTOGRAM_3DS"]

/**
 * Identify your gateway and your site's gateway merchant identifier
 *
 * The Google Pay API response will return an encrypted payment method capable
 * of being charged by a supported gateway after payer authorization
 *
 * @todo check with your gateway on the parameters to pass
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#gateway|PaymentMethodTokenizationSpecification}
 */
const tokenizationSpecification = {
  type: "PAYMENT_GATEWAY",
  parameters: {
    gateway: "example",
    gatewayMerchantId: "exampleGatewayMerchantId",
  },
}

/**
 * Describe your site's support for the CARD payment method and its required
 * fields
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}
 */
const baseCardPaymentMethod = {
  type: "CARD",
  parameters: {
    allowedAuthMethods: allowedCardAuthMethods,
    allowedCardNetworks: allowedCardNetworks,
  },
}

/**
 * Describe your site's support for the CARD payment method including optional
 * fields
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}
 */
const cardPaymentMethod = Object.assign({}, baseCardPaymentMethod, {
  tokenizationSpecification: tokenizationSpecification,
})

/**
 * An initialized google.payments.api.PaymentsClient object or null if not yet set
 *
 * @see {@link getGooglePaymentsClient}
 */
let paymentsClient = null

/**
 * Configure your site's support for payment methods supported by the Google Pay
 * API.
 *
 * Each member of allowedPaymentMethods should contain only the required fields,
 * allowing reuse of this base request when determining a viewer's ability
 * to pay and later requesting a supported payment method
 *
 * @returns {object} Google Pay API version, payment methods supported by the site
 */
function getGoogleIsReadyToPayRequest() {
  return Object.assign({}, baseRequest, {
    allowedPaymentMethods: [baseCardPaymentMethod],
  })
}

/**
 * Configure support for the Google Pay API
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#PaymentDataRequest|PaymentDataRequest}
 * @returns {object} PaymentDataRequest fields
 */
function getGooglePaymentDataRequest() {
  const paymentDataRequest = Object.assign({}, baseRequest)
  paymentDataRequest.allowedPaymentMethods = [cardPaymentMethod]
  paymentDataRequest.transactionInfo = getGoogleTransactionInfo()
  paymentDataRequest.merchantInfo = {
    // @todo a merchant ID is available for a production environment after approval by Google
    // See {@link https://developers.google.com/pay/api/web/guides/test-and-deploy/integration-checklist|Integration checklist}
    // merchantId: '01234567890123456789',
    merchantName: "Example Merchant",
  }
  return paymentDataRequest
}

/**
 * Return an active PaymentsClient or initialize
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/client#PaymentsClient|PaymentsClient constructor}
 * @returns {google.payments.api.PaymentsClient} Google Pay API client
 */
function getGooglePaymentsClient() {
  if (paymentsClient === null) {
    paymentsClient = new google.payments.api.PaymentsClient({
      environment: "TEST",
    })
  }
  return paymentsClient
}

/**
 * Initialize Google PaymentsClient after Google-hosted JavaScript has loaded
 *
 * Display a Google Pay payment button after confirmation of the viewer's
 * ability to pay.
 */
function onGooglePayLoaded() {
  const paymentsClient = getGooglePaymentsClient()
  paymentsClient
    .isReadyToPay(getGoogleIsReadyToPayRequest())
    .then(function (response) {
      if (response.result) {
        addGooglePayButton()
        // @todo prefetch payment data to improve performance after confirming site functionality
        // prefetchGooglePaymentData();
      }
    })
    .catch(function (err) {
      // show error in developer console for debugging
      console.error(err)
    })
}

/**
 * Add a Google Pay purchase button alongside an existing checkout button
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#ButtonOptions|Button options}
 * @see {@link https://developers.google.com/pay/api/web/guides/brand-guidelines|Google Pay brand guidelines}
 */
function addGooglePayButton() {
  const paymentsClient = getGooglePaymentsClient()
  const button = paymentsClient.createButton({
    onClick: onGooglePaymentButtonClicked,
  })
  document.getElementById("container").appendChild(button)
}

/**
 * Provide Google Pay API with a payment amount, currency, and amount status
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#TransactionInfo|TransactionInfo}
 * @returns {object} transaction info, suitable for use as transactionInfo property of PaymentDataRequest
 */
function getGoogleTransactionInfo() {
  return {
    countryCode: "US",
    currencyCode: "USD",
    totalPriceStatus: "FINAL",
    // set to cart total
    totalPrice: "1.00",
  }
}

/**
 * Prefetch payment data to improve performance
 *
 * @see {@link https://developers.google.com/pay/api/web/reference/client#prefetchPaymentData|prefetchPaymentData()}
 */
function prefetchGooglePaymentData() {
  const paymentDataRequest = getGooglePaymentDataRequest()
  // transactionInfo must be set but does not affect cache
  paymentDataRequest.transactionInfo = {
    totalPriceStatus: "NOT_CURRENTLY_KNOWN",
    currencyCode: "USD",
  }
  const paymentsClient = getGooglePaymentsClient()
  paymentsClient.prefetchPaymentData(paymentDataRequest)
}

/**
 * Show Google Pay payment sheet when Google Pay payment button is clicked
 */
function onGooglePaymentButtonClicked() {
  const paymentDataRequest = getGooglePaymentDataRequest()
  paymentDataRequest.transactionInfo = getGoogleTransactionInfo()

  const paymentsClient = getGooglePaymentsClient()
  paymentsClient
    .loadPaymentData(paymentDataRequest)
    .then(function (paymentData) {
      // handle the response
      processPayment(paymentData)
    })
    .catch(function (err) {
      // show error in developer console for debugging
      console.error(err)
    })
}

/**
 * Process payment data returned by the Google Pay API
 *
 * @param {object} paymentData response from Google Pay API after user approves payment
 * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#PaymentData|PaymentData object reference}
 */
function processPayment(paymentData) {
  // show returned data in developer console for debugging
  console.log(paymentData)
  // @todo pass payment token to your gateway to process payment
  paymentToken = paymentData.paymentMethodData.tokenizationData.token
}
</code></pre>
</body>
</html>
</article></div></article></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Google Pay API 가이드","date":"2020-03-13","slug":"others/2020/google-pay-api-guide/index","content":"\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n\u003cmeta charset=\"utf-8\"\u003e\n\u003ctitle\u003eContents\u003c/title\u003e\n\u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cp\u003eGoogle Pay API를 해보는 과정을 정리해보려고 합니다.\u003c/p\u003e\n\u003cp\u003eGoogle Pay API를 테스트하기전에 nodeJS express를 통해 웹서버를 만들어야 합니다. \u003ca href=\"/2020-03-13-nodejs-express-guide.markdown\"\u003e링크\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://developers.google.com/pay/api/web/guides/setup\"\u003eGoogle Pay API 설정\u003c/a\u003e에서 결제 수단을 링크를 눌러 카드를 등록합니다.\u003c/p\u003e\n\u003cp\u003e로그인 한 계정에 신용카드 또는 체크카드를 추가하면 결제 수단 등록이 완료됩니다.\u003c/p\u003e\n\u003cp\u003e이제 왼쪽 네비게이션 가이드 - 가이드 메뉴를 누릅니다.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"./images/google-pay-selected-guide.png\" alt=\"구글 가이드\"\u003e{: width=\"50%\"}\u003c/p\u003e\n\u003cp\u003e가이드를 참조하시면서 함수와 설명을 잘 읽어봅니다.\n버튼이 나타나기 위해선 아래와 같이 div로 버튼 영역을 잡아주고\n아래 스크립트는 구글페이를 사용하기 위해서 필요한 외부함수입니다. 저희쪽에서 가지고 있을 js파일이 아닙니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026#x3C;div id=\"container\"\u003e\u0026#x3C;/div\u003e\n\u0026#x3C;script\n  async\n  src=\"https://pay.google.com/gp/p/js/pay.js\"\n  onload=\"onGooglePayLoaded()\"\n\u003e\u0026#x3C;/script\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e아래는 우리쪽에서 파일로 만들어야 할 js입니다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e/**\n * Define the version of the Google Pay API referenced when creating your\n * configuration\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#PaymentDataRequest|apiVersion in PaymentDataRequest}\n */\nconst baseRequest = {\n  apiVersion: 2,\n  apiVersionMinor: 0,\n}\n\n/**\n * Card networks supported by your site and your gateway\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}\n * @todo confirm card networks supported by your site and gateway\n */\nconst allowedCardNetworks = [\n  \"AMEX\",\n  \"DISCOVER\",\n  \"INTERAC\",\n  \"JCB\",\n  \"MASTERCARD\",\n  \"VISA\",\n]\n\n/**\n * Card authentication methods supported by your site and your gateway\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}\n * @todo confirm your processor supports Android device tokens for your\n * supported card networks\n */\nconst allowedCardAuthMethods = [\"PAN_ONLY\", \"CRYPTOGRAM_3DS\"]\n\n/**\n * Identify your gateway and your site's gateway merchant identifier\n *\n * The Google Pay API response will return an encrypted payment method capable\n * of being charged by a supported gateway after payer authorization\n *\n * @todo check with your gateway on the parameters to pass\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#gateway|PaymentMethodTokenizationSpecification}\n */\nconst tokenizationSpecification = {\n  type: \"PAYMENT_GATEWAY\",\n  parameters: {\n    gateway: \"example\",\n    gatewayMerchantId: \"exampleGatewayMerchantId\",\n  },\n}\n\n/**\n * Describe your site's support for the CARD payment method and its required\n * fields\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}\n */\nconst baseCardPaymentMethod = {\n  type: \"CARD\",\n  parameters: {\n    allowedAuthMethods: allowedCardAuthMethods,\n    allowedCardNetworks: allowedCardNetworks,\n  },\n}\n\n/**\n * Describe your site's support for the CARD payment method including optional\n * fields\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#CardParameters|CardParameters}\n */\nconst cardPaymentMethod = Object.assign({}, baseCardPaymentMethod, {\n  tokenizationSpecification: tokenizationSpecification,\n})\n\n/**\n * An initialized google.payments.api.PaymentsClient object or null if not yet set\n *\n * @see {@link getGooglePaymentsClient}\n */\nlet paymentsClient = null\n\n/**\n * Configure your site's support for payment methods supported by the Google Pay\n * API.\n *\n * Each member of allowedPaymentMethods should contain only the required fields,\n * allowing reuse of this base request when determining a viewer's ability\n * to pay and later requesting a supported payment method\n *\n * @returns {object} Google Pay API version, payment methods supported by the site\n */\nfunction getGoogleIsReadyToPayRequest() {\n  return Object.assign({}, baseRequest, {\n    allowedPaymentMethods: [baseCardPaymentMethod],\n  })\n}\n\n/**\n * Configure support for the Google Pay API\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#PaymentDataRequest|PaymentDataRequest}\n * @returns {object} PaymentDataRequest fields\n */\nfunction getGooglePaymentDataRequest() {\n  const paymentDataRequest = Object.assign({}, baseRequest)\n  paymentDataRequest.allowedPaymentMethods = [cardPaymentMethod]\n  paymentDataRequest.transactionInfo = getGoogleTransactionInfo()\n  paymentDataRequest.merchantInfo = {\n    // @todo a merchant ID is available for a production environment after approval by Google\n    // See {@link https://developers.google.com/pay/api/web/guides/test-and-deploy/integration-checklist|Integration checklist}\n    // merchantId: '01234567890123456789',\n    merchantName: \"Example Merchant\",\n  }\n  return paymentDataRequest\n}\n\n/**\n * Return an active PaymentsClient or initialize\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/client#PaymentsClient|PaymentsClient constructor}\n * @returns {google.payments.api.PaymentsClient} Google Pay API client\n */\nfunction getGooglePaymentsClient() {\n  if (paymentsClient === null) {\n    paymentsClient = new google.payments.api.PaymentsClient({\n      environment: \"TEST\",\n    })\n  }\n  return paymentsClient\n}\n\n/**\n * Initialize Google PaymentsClient after Google-hosted JavaScript has loaded\n *\n * Display a Google Pay payment button after confirmation of the viewer's\n * ability to pay.\n */\nfunction onGooglePayLoaded() {\n  const paymentsClient = getGooglePaymentsClient()\n  paymentsClient\n    .isReadyToPay(getGoogleIsReadyToPayRequest())\n    .then(function (response) {\n      if (response.result) {\n        addGooglePayButton()\n        // @todo prefetch payment data to improve performance after confirming site functionality\n        // prefetchGooglePaymentData();\n      }\n    })\n    .catch(function (err) {\n      // show error in developer console for debugging\n      console.error(err)\n    })\n}\n\n/**\n * Add a Google Pay purchase button alongside an existing checkout button\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#ButtonOptions|Button options}\n * @see {@link https://developers.google.com/pay/api/web/guides/brand-guidelines|Google Pay brand guidelines}\n */\nfunction addGooglePayButton() {\n  const paymentsClient = getGooglePaymentsClient()\n  const button = paymentsClient.createButton({\n    onClick: onGooglePaymentButtonClicked,\n  })\n  document.getElementById(\"container\").appendChild(button)\n}\n\n/**\n * Provide Google Pay API with a payment amount, currency, and amount status\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/request-objects#TransactionInfo|TransactionInfo}\n * @returns {object} transaction info, suitable for use as transactionInfo property of PaymentDataRequest\n */\nfunction getGoogleTransactionInfo() {\n  return {\n    countryCode: \"US\",\n    currencyCode: \"USD\",\n    totalPriceStatus: \"FINAL\",\n    // set to cart total\n    totalPrice: \"1.00\",\n  }\n}\n\n/**\n * Prefetch payment data to improve performance\n *\n * @see {@link https://developers.google.com/pay/api/web/reference/client#prefetchPaymentData|prefetchPaymentData()}\n */\nfunction prefetchGooglePaymentData() {\n  const paymentDataRequest = getGooglePaymentDataRequest()\n  // transactionInfo must be set but does not affect cache\n  paymentDataRequest.transactionInfo = {\n    totalPriceStatus: \"NOT_CURRENTLY_KNOWN\",\n    currencyCode: \"USD\",\n  }\n  const paymentsClient = getGooglePaymentsClient()\n  paymentsClient.prefetchPaymentData(paymentDataRequest)\n}\n\n/**\n * Show Google Pay payment sheet when Google Pay payment button is clicked\n */\nfunction onGooglePaymentButtonClicked() {\n  const paymentDataRequest = getGooglePaymentDataRequest()\n  paymentDataRequest.transactionInfo = getGoogleTransactionInfo()\n\n  const paymentsClient = getGooglePaymentsClient()\n  paymentsClient\n    .loadPaymentData(paymentDataRequest)\n    .then(function (paymentData) {\n      // handle the response\n      processPayment(paymentData)\n    })\n    .catch(function (err) {\n      // show error in developer console for debugging\n      console.error(err)\n    })\n}\n\n/**\n * Process payment data returned by the Google Pay API\n *\n * @param {object} paymentData response from Google Pay API after user approves payment\n * @see {@link https://developers.google.com/pay/api/web/reference/response-objects#PaymentData|PaymentData object reference}\n */\nfunction processPayment(paymentData) {\n  // show returned data in developer console for debugging\n  console.log(paymentData)\n  // @todo pass payment token to your gateway to process payment\n  paymentToken = paymentData.paymentMethodData.tokenizationData.token\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n"}},"__N_SSG":true},"page":"/posts/[...slug]","query":{"slug":["others","2020","google-pay-api-guide","index"]},"buildId":"x4I7aGmlNNdMMn8qGuRvp","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>