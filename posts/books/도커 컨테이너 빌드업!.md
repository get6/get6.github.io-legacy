---
created: 2023-07-09 16:18
tag: 📚 책 국내도서 IT모바일 네트워크/해킹/보안 네트워크일반 OS/데이터베이스 클라우드/빅데이터 컴퓨터공학 소프트웨어공학
title: 도커, 컨테이너 빌드업!：최적의 컨테이너 서비스를 위한 도커 활용법
author: 이현룡
category: 국내도서
total_page: 384
publish_date: 2021-12-27
cover_url: https://image.yes24.com/goods/105756626/XL
status: 📖 읽고있어
start_read_date: 2023-07-09
finish_read_date: 2023-07-09
my_rate: 0
book_note: ...
---

42서울 5서클 과제 중 하나인 Inception을 위해서 이 책을 읽기 시작했다.
이것말고도 그림으로 이해하는~ 을 읽고 싶었지만 전자도서관에서 누군가 대출하고 있어서 이걸 선택했다.

IT산업에서 자주 쓰이는 키워드들을 따로 설명없이 사용하고 있어서 IT 초보자입장에서는 난이도가 있는 책일지도 모르겠다. 예) 고가용성, IaaS, 프로비저닝, 메인 프레임 등
일부는 각주로 달려있거나 뒤에서 설명해주신다.

# 1장
1장은 도커와 관련있는 내용들을 설명한다. 인프라쪽에서 왜 도커라는 기술이 필요해졌고 데브옵스로 인해 서비스 개발의 더 집중할 수 있게되었다는 배경을 설명한다.
또한 도커의 발전 과정을 알려주기 때문에 LXC부터 libcontainer OC를 거쳐서 runC OCI까지 도커 내부 기술어떤 식으로 바뀌어 왔는지도 간략하게 알 수 있다.

# 2장
나는 M1 + Ventura 13.4.1 환경에서 진행했다. 가상머신 프로그램으로는 UTM을 사용했고 Linux OS는 ubuntu-22.04.1-live-server-arm64를 사용했다.

책에서 하라는 대로 하면 docker가 제대로 설치되지 않는다. ~~arm64라 그런 것 같다.~~ ubuntu 버전이 20.04 이상이라 그런 것 같다.
`sudo apt-get -y install docker-ce` 대신 `sudo snap install docker`

그리고 snap으로 설치해서 그런지 `sudo systemctl restart docker, sudo systemctl status docker` 를 확인할 수 없었다.
또한 `sudo usermod -aG docker $(whoami)`도 되지 않았다.
이대로 포기해야 하나 싶었지만 구글링을 통해 해결할 수 있었다.
자세한 설명은 [Snap으로 docker 설치 하기 Ubuntu 20.04](https://voidint.com/2021/06/28/snap%EC%9C%BC%EB%A1%9C-docker-%EC%84%A4%EC%B9%98-%ED%95%98%EA%B8%B0-ubuntu-20-04/)을 참고하길 바란다. 이 과정을 수행하면 내 환경에서 도커를 사용할 수 있게 된다.

근데 과정을 따라하다가 ssh로 가상머신 OS 접근해서 한 화면에 iTerm(4):전자책(6) 비율로 나눠서 보고 싶은 마음이 들었다.

> UTM에 ssh 연결 방법
1. `sudo apt-get install net-tools`를 통해 `ifconfig`를 설치
2. `ifconfig` 명령어를 수행하고 나온 출력문 중에 나온 IP 주소(내 경우 enp0s1)를 확인
3. `ssh {사용자명}@{IP} -p22`로 접속한 뒤 비밀번호를 입력하고 연결

# 3장
**도커 이미지 세부 정보 조회 파트**에서 도커 명령어 활용 중 관리자 권한으로 변경하고 `/var/lib/docker` 경로에 들어가는 부분이 있다.
snap으로 설치했기 때문에 나는 `/var/snap/docker/common/var-lib-docker` 이 경로로 들어가야 했다.

**도커 로그인 및 로그아웃** 파트에서 `cat ~ /.docker/config.json`을 확인하는 부분도 다르기 때문에 나는 `cat ./snap/docker/2895/.docker/config.json` 이 경로로 확인했다.

웹에서 접속해서 Access Token을 발급받아야 하기 때문에 복사 붙여넣기가 편하게 SSH 접속을 해서 하길 권장한다.

**도커 이미지를 파일로 관리** 파트에서 사용하고 있던 컴퓨터가 M1이라 arm64 환경이라 mysql5.7을 다운로드 할 수 없었다. 지금 예제에선 mysql을 실행하진 않으니 문제가 생길까 걱정하지 않아도 괜찮다. `docker pull arm64v8/mysql`나 `docker pull mysql` 둘 중 아무거나 내려받으면 된다.

도커 컨테이너 명령어들을 배운다. build, image, login, push, pull, commit, run, create, exec, attach, export, import, container, inspect, ps, logs, top, stats, stop, pause, unpause, restart, kill, rm이 주요 쓰이는 것들 같다.

컨테이너를 제어하기 위한 명령어들인 create, start 명령어를 차례로 쓰는 것과 run 명령어는 비슷한 효과를 볼 수 있다.

~~위에서 mysql 5.7 버전이 깔리지 않는다 했지만 이렇게 하면 받을 수 있다. `docker pull --platform linux/amd64 mysql:5.7` 실습 3-1을 위해선 5.7로 하는 것이 쉬운 것 같다.~~ 실행이 되지 않는다...
cAdvisor도 M1에서는 지원하지 않는 것 같다.

볼륨에 대한 처리를 할 때 도커 컨테이너가 어떤 것이냐에 따라 활용되는 특정 경로에다가  docker cp를 통해 소스를 전달하는 방법보다, 호스트 경로에 있는 폴더를 볼륨에 연결해서 작업하는 방법이 더 낫다.

볼륨 지정은 잘못된 이름이나 경로여도 폴더를 만들어내기 때문에 오타에 주의해야 할 것 같다. 예시를 그대로 따라하다보면 저자의 `/home/hylee` 경로가 그대로 노출되는 부분이 있는데 내 경로로 바꿔야 예상치 못한 결과를 피할 수 있을 것이다(실제로 그대로 해보진 않아서 안되는지는 모르겠다).

내가 도커를 어렵다고 느끼는 이유에는 도커의 구조, 명령어, 컨테이너 생명 주기(호스트와 연결되지 않은 데이터의 휘발성), 볼륨 연결, 실제로 어떻게 도커를 활용하는지를 잘 알지 못해서 부담을 느끼는 것 같다.

볼륨을 호스트에서 만들어야 할 경우도 있거나 특정 폴더를 지정해서 쓰는 방식이 있을 수 있다. 아직 도커 볼륨을 실무에서 사용되는 모범 사례를 모르기 때문에 이미 만들어진 볼륨이나 폴더를 확인해서 만들지 말지도 확인해야 하지 않을까 싶다.

도커는 격리된 환경을 제공하기 때문에 자원도 할당하기 편하다. 특정 애플리케이션에서 요구되는 권장 사항까지만 자원을 사용하게 두는 것이 일반적인지 궁금해졌다. 대부분의 도커는 클라우드에서 올라갈텐데 자원을 많이 쓰지 않아야 청구 요금을 줄일 수 있는데 클라우드 제공하는 컴퓨터 자원을 설정하니깐 굳이 하지 않는지 아니면 도커에서도 용량을 제한하는 옵션을 같이 쓰는지 알아봐야 할 것 같다.

# 4장
이제 Dockerfile을 사용한다. IaC에 대한 개념도 알려준다.
Dockerfile로 Docker Image를 Build한 뒤, Docker Container를 Run한다.

## 자주 사용되는 Dockefile 명령어
FROM

MAINTAINER

LABEL

RUN

CMD

ENTRYPOINT

COPY

ADD

ENV

EXPOSE

VOLUME

USER

WORKDIR

ARG

ONBUILD

STOPSIGNAL

HEALTHCHECK

SHELL

