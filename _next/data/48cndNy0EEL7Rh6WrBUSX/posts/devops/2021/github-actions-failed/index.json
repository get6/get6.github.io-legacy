{"pageProps":{"post":{"title":"GitHub Actions가 에러날 때 해결방법","date":"2021-03-15","slug":"devops/2021/github-actions-failed/index","content":"<p>블로그 source 브랜치를 깃허브에 push하면 자동적으로 master 브랜치에 deploy하려고 했는데 이게 매번 실패했다.</p>\n<p>나는 가끔 글을 쓰고 수동으로 배포 작업을했는데 어느날, 메일에 CI 작업이 실패했다고 와서 알게됬다.</p>\n<p>한동안은 블로그를 typescript로 바꾸느라 애먹고 있었는데 이번에 error를 다 없앤김에 이 오류도 해결하기로 마음 먹었다.</p>\n<p>가장 최근에 오류는 이것이다.</p>\n<p><img src=\"images/build-failed.png\" alt=\"actions-failed\"></p>\n<p>문제는 <code>The process 'npm' failed with exit code 254</code> 이거 같은데 나는 GitHub Actions을 이해하고 쓰지 않았고 예제를 보며해봤기 때문에 이참에</p>\n<p>GitHub Actions 가이드 문서를 보기로 했다. -> <a href=\"https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions\">Introduction to GitHub Actions</a> 과 <a href=\"https://docs.github.com/en/actions/guides/building-and-testing-nodejs\">Building and Testing NodeJS</a></p>\n<p>나는 이 사람이 만든 <a href=\"https://github.com/enriikke/gatsby-gh-pages-action\">Action</a>을 이용했고, 기존 코드를 수정할 필요가 있었다.</p>\n<p>기존 코드는 아래와 같다.</p>\n<pre><code># This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node\n# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions\n\nname: GatsbyJS Deploy\n\non:\n  push:\n    branches: [ source ]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n    - name: Gatsby Publish\n      uses: enriikke/gatsby-gh-pages-action@v2.1.1\n      with:\n        # A personal access token needed to push your site after it has been built.\n        access-token: ${{ secrets.GATSBY_PUBLISH_ACCESS_TOKEN }}\n        # The branch expected by GitHub to have the static files needed for your site.\n        deploy-branch: master # optional, default is master\n        # Additional arguments that get passed to `gatsby build`.\n        gatsby-args: gh-pages -d public # optional, default i\n</code></pre>\n<p>수정을 몇번 해보면서 테스트 해보니 <code>every step must define a `uses` or `run` key</code>라는 오류가 떴었다.</p>\n<pre><code>- uses: actions/checkout@v2\n- name: Gatsby Publish\n- uses: enriikke/gatsby-gh-pages-action@v2.1.1\n</code></pre>\n<p>원인은 name 다음에는 해당 하나의 uses만 있어야 하는데 배열 선언 방식으로 해서 그런거 같다.<br>\n해결 방법은 아래처럼 하면된다.</p>\n<pre><code>- uses: actions/checkout@v2\n- name: Gatsby Publish\n  uses: enriikke/gatsby-gh-pages-action@v2.1.1\n</code></pre>\n<p>또 이런 에러도 났었다. <code>The process 'git' failed with exit code 128</code>\n이건 내가 GATSBY_PUBLISH_ACCESS_TOKEN을 잘 못 넣었다.<br>\nGitHub.com -> Settings -> Developer settings -> Personal access tokens -> Generate new token을 누르고 원하는 이름으로 발급된 토큰값을 복사한다.<br>\n그 다음 블로그 Repository로 간 다음, Setting -> Secrets에 원하는 이름을 넣고(내 경우는 GATSBY_PUBLISH_ACCESS_TOKEN) 거기에 아까 만든 토큰값을 붙여 넣는다.</p>\n<p>배포에 사용되는 코드는 다음과 같다.</p>\n<pre><code>name: GatsbyJS Deploy\non:\n  push:\n    branches:\n      - source\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - name: Gatsby Publish\n        uses: enriikke/gatsby-gh-pages-action@v2.1.1\n        with:\n          # A personal access token needed to push your site after it has been built.\n          access-token: ${{ secrets.GATSBY_PUBLISH_ACCESS_TOKEN }}\n          gatsby-args: --verbose\n          \n</code></pre>\n"}},"__N_SSG":true}